<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>field</title>
<style>
:root{
  --bg1:#071516;
  --bg2:#0e2423;

  --card1:rgba(14,40,40,0.90);
  --card2:rgba(5,20,20,0.90);

  --mint:#7ef5b5;
  --mint2:#9fffcf;

  --header:#e6f1ee;
  --soft:rgba(230,241,238,0.70);

  --circleText:#063a2b;
  --shadow: rgba(0,0,0,0.55);
}

*{ box-sizing:border-box; margin:0; padding:0; }
body{
  min-height:100vh;
  background:
    radial-gradient(circle at top, #143332, var(--bg1)),
    linear-gradient(var(--bg1), var(--bg2));
  display:flex;
  justify-content:center;
  align-items:center;
  color:var(--header);
  font-family: Georgia, "Times New Roman", serif;
}

.wrapper{
  width:100%;
  max-width:420px;
  padding: 40px 20px 60px;
  text-align:center;
}

/* Header wordmark constrained to circle width */
.header{
  width: 210px;          /* matches circle size */
  margin: 0 auto 34px;
  display:flex;
  justify-content:space-between;
  align-items:baseline;
  font-weight:400;
  font-size: 3.6rem;
  letter-spacing: 0;
  color: var(--header);
  transition: opacity 900ms ease;
}
.header span{
  display:inline-block;
  line-height:1;
}

/* card */
.card{
  background: linear-gradient(160deg, var(--card1), var(--card2));
  border-radius: 26px;
  padding: 40px 25px 38px;
  box-shadow: 0 30px 60px var(--shadow);
}

/* circle + ripple */
.circleWrap{
  position:relative;
  width:210px;
  height:210px;
  margin: 0 auto 22px;
}

.circle{
  width:210px;
  height:210px;
  border-radius:50%;
  background: radial-gradient(circle at 30% 30%, var(--mint2), var(--mint));
  display:flex;
  align-items:center;
  justify-content:center;
  font-family: Arial, system-ui, sans-serif;
  letter-spacing: 0.15em;
  text-transform: uppercase;
  font-size: 0.72rem;
  color: var(--circleText);
  box-shadow: 0 0 52px rgba(126,245,181,0.52);
  cursor:pointer;
  user-select:none;
  transition: box-shadow 900ms ease, filter 900ms ease, opacity 420ms ease;
}

/* breathing motion */
.circle.breathing{
  animation: breathe 11s ease-in-out infinite;
}
@keyframes breathe{
  0%{ transform: scale(0.84); }
  50%{ transform: scale(1.00); }
  100%{ transform: scale(0.84); }
}

/* subtle phase glow shift */
.circle.phase-in{
  box-shadow: 0 0 58px rgba(126,245,181,0.60);
  filter: brightness(1.02);
}
.circle.phase-out{
  box-shadow: 0 0 44px rgba(126,245,181,0.42);
  filter: brightness(0.99);
}

/* start ripple */
.ripple{
  position:absolute;
  inset:0;
  border-radius:50%;
  border: 1px solid rgba(126,245,181,0.0);
  transform: scale(0.86);
  opacity:0;
  pointer-events:none;
}
.ripple.go{
  animation: ripple 1100ms ease-out 1;
}
@keyframes ripple{
  0%{
    opacity:0.55;
    transform: scale(0.86);
    border-color: rgba(126,245,181,0.35);
  }
  100%{
    opacity:0;
    transform: scale(1.22);
    border-color: rgba(126,245,181,0.0);
  }
}

/* intention */
.intent{
  color: var(--header);
  font-weight: 400;
  font-size: 1.65rem;
  line-height: 1.1;
  margin: 18px 0 8px;
  cursor:pointer;
  user-select:none;

  white-space: nowrap;
  overflow: visible;
  transition: opacity 420ms ease;
}
.intent.pulse{
  text-shadow: 0 0 14px rgba(126,245,181,0.18);
}
.sub{
  font-size: 0.92rem;
  color: var(--soft);
  margin-bottom: 22px;
  transition: opacity 420ms ease;
}

/* fade intention during session (silent mode) */
.running .intent,
.running .sub{
  opacity: 0;
  pointer-events:none;
}

/* single toggle button */
.controls{ display:flex; justify-content:center; margin-top: 6px; }
button{
  border:none;
  border-radius: 999px;
  padding: 12px 30px;
  font-size: 1rem;
  cursor:pointer;
  color: #063a2b;
  background: linear-gradient(135deg, #6deeb0, var(--mint));
  box-shadow: 0 6px 18px rgba(126,245,181,0.36);
  transition: transform 140ms ease, filter 140ms ease, opacity 140ms ease;
}
button:active{ transform: scale(0.99); }
button:hover{ filter: brightness(1.02); }

/* small screens */
@media (max-width: 360px){
  .header{ width: 200px; font-size: 3.25rem; }
  .circleWrap,.circle{ width:200px; height:200px; }
  .intent{ font-size: 1.52rem; }
}

.lang-toggle{
  position:absolute;
  top:12px;
  right:16px;
  font-size:12px;
  letter-spacing:0.12em;
  opacity:0.7;
}
.lang-toggle span{
  cursor:pointer;
}
.lang-toggle span.active{
  opacity:1;
}

</style>
</head>
<body>

<div class="lang-toggle">
  <span id="enBtn">EN</span> · <span id="esBtn">ES</span>
</div>

  <div class="wrapper" id="app">
    <div class="header" id="header" aria-label="field wordmark">
      <span>f</span><span>i</span><span>e</span><span>l</span><span>d</span>
    </div>

    <div class="card">
      <div class="circleWrap">
        <div class="ripple" id="ripple"></div>
        <div class="circle" id="circle" aria-live="polite">FOLLOW THE CIRCLE</div>
      </div>

      <div class="intent" id="intent" tabindex="0">Equanimity and awareness</div>
      <div class="sub" id="sub">the field is shared.</div>

      <div class="controls">
        <button id="toggleBtn" type="button">Start</button>
      </div>
    </div>
  </div>

<script>
(() => {
  'use strict';

  // Language + Chile-tuned Spanish
  let lang = 'en';
  const TEXT = {
    en: {
      header: "field",
      inhale: "INHALE",
      exhale: "EXHALE",
      start: "START",
      stop: "STOP",
      follow: "FOLLOW THE CIRCLE",
      sub: "the field is shared.",
      intentions: [
        "Equanimity and awareness",
        "Steady and open",
        "Soft and spacious",
        "Let it arrive",
        "Nothing to fix",
        "Here and now",
        "Be the field",
        "Rest in the field",
        "Clear and kind"
      ]
    },
    es: {
      header: "campo",
      inhale: "INHALA",
      exhale: "EXHALA",
      start: "COMENZAR",
      stop: "DETENER",
      follow: "SIGUE EL CÍRCULO",
      sub: "el campo se comparte.",
      intentions: [
        "Calma y atención",
        "Tranquilo y abierto",
        "Suave y amplio",
        "Deja que llegue",
        "Nada que arreglar",
        "Aquí y ahora",
        "Sé el campo presente",
        "Descansa en el campo",
        "Claro y cariñoso"
      ]
    }
  };

  // Breath timing (stabiliser default)
  const IN_SEC  = 5.5;
  const OUT_SEC = 5.5;

  // DOM
  const app       = document.getElementById('app');
  const header    = document.getElementById('header');
  const circle    = document.getElementById('circle');
  const ripple    = document.getElementById('ripple');
  const toggleBtn = document.getElementById('toggleBtn');
  const intentEl  = document.getElementById('intent');
  const subEl     = document.getElementById('sub');

  const enBtn = document.getElementById('enBtn');
  const esBtn = document.getElementById('esBtn');

  
  // Defensive: ensure required elements exist (prevents silent failures)
  const REQUIRED = { app, header, circle, ripple, toggleBtn, intentEl, subEl, enBtn, esBtn };
  const missing = Object.entries(REQUIRED).filter(([,v]) => !v).map(([k]) => k);
  if (missing.length){
    console.error("Field: missing DOM elements:", missing.join(", "));
    return;
  }

// State
  let running = false;
  let intentions = [];
  let intentIndex = 0;
  let firstCycleGuidance = true;

  // Timers
  let phaseTimeoutA = null;
  let phaseTimeoutB = null;
  let labelTimeoutA = null;
  let labelTimeoutB = null;

  function renderHeaderWord(word){
    header.innerHTML = '';
    for (const ch of word){
      const s = document.createElement('span');
      s.textContent = ch;
      header.appendChild(s);
    }
  }

  function setLanguage(l){
    lang = l;

    // UI text
    renderHeaderWord(TEXT[lang].header);
    subEl.textContent = TEXT[lang].sub;

    // Intentions
    intentions = [...TEXT[lang].intentions];
    intentIndex = 0;

    // Always update the button label to match state
    toggleBtn.textContent = running ? TEXT[lang].stop : TEXT[lang].start;

    // If we're idle, update the visible prompt + first intention
    if (!running){
      intentEl.textContent = intentions[0];
      circle.textContent = TEXT[lang].follow;
      return;
    }

    // If we're mid-session and still guiding first cycle, keep the current label in-language
    if (firstCycleGuidance){
      // If circle currently shows a guidance label, swap it in-place.
      const cur = (circle.textContent || '').trim().toUpperCase();
      if (cur === TEXT.en.inhale || cur === TEXT.en.exhale || cur === TEXT.es.inhale || cur === TEXT.es.exhale){
        // infer phase by current text
        if (cur.includes('INH') || cur.includes('HAL')) circle.textContent = TEXT[lang].inhale;
        else circle.textContent = TEXT[lang].exhale;
      }
    }
  }
  }

  function clearTimers(){
    if (phaseTimeoutA) { clearTimeout(phaseTimeoutA); phaseTimeoutA = null; }
    if (phaseTimeoutB) { clearTimeout(phaseTimeoutB); phaseTimeoutB = null; }
    if (labelTimeoutA) { clearTimeout(labelTimeoutA); labelTimeoutA = null; }
    if (labelTimeoutB) { clearTimeout(labelTimeoutB); labelTimeoutB = null; }
  }

  function setGlowPhase(phase){
    circle.classList.remove('phase-in','phase-out');
    circle.classList.add(phase === 'in' ? 'phase-in' : 'phase-out');
  }

  function startGlowLoop(){
    clearTimeout(phaseTimeoutA);
    clearTimeout(phaseTimeoutB);

    setGlowPhase('in');
    phaseTimeoutA = setTimeout(() => {
      setGlowPhase('out');
      phaseTimeoutB = setTimeout(() => {
        if (running) startGlowLoop();
      }, OUT_SEC * 1000);
    }, IN_SEC * 1000);
  }

  function startFirstCycleLabels(){
    clearTimeout(labelTimeoutA);
    clearTimeout(labelTimeoutB);

    circle.textContent = TEXT[lang].inhale;
    labelTimeoutA = setTimeout(() => {
      circle.textContent = TEXT[lang].exhale;
      labelTimeoutB = setTimeout(() => {
        if (running) circle.textContent = ''; // silent thereafter
        firstCycleGuidance = false;
      }, OUT_SEC * 1000);
    }, IN_SEC * 1000);
  }

  function forceRestartAnimation(el, cls){
    el.classList.remove(cls);
    void el.offsetWidth;
    el.classList.add(cls);
  }

  function startSession(){
    if (running) return;
    running = true;

    app.classList.add('running');
    header.style.opacity = '0.25';

    ripple.classList.remove('go');
    void ripple.offsetWidth;
    ripple.classList.add('go');

    forceRestartAnimation(circle, 'breathing');

    firstCycleGuidance = true;
    startFirstCycleLabels();

    startGlowLoop();

    toggleBtn.textContent = TEXT[lang].stop;
  }

  function stopSession(){
    running = false;

    app.classList.remove('running');
    header.style.opacity = '1';

    clearTimers();
    circle.classList.remove('breathing','phase-in','phase-out');

    circle.textContent = TEXT[lang].follow;
    toggleBtn.textContent = TEXT[lang].start;
  }

  function toggleSession(){
    running ? stopSession() : startSession();
  }

  function fadeIntentTo(text){
    intentEl.style.opacity = '0';
    intentEl.classList.remove('pulse');
    setTimeout(() => {
      intentEl.textContent = text;
      intentEl.style.opacity = '1';
      intentEl.classList.add('pulse');
      setTimeout(() => intentEl.classList.remove('pulse'), 520);
    }, 220);
  }

  function nextIntent(){
    if (running) return;
    if (!intentions.length) return;
    intentIndex = (intentIndex + 1) % intentions.length;
    fadeIntentTo(intentions[intentIndex]);
  }

  // Events
  toggleBtn.addEventListener('click', toggleSession);
  circle.addEventListener('click', () => { if (!running) startSession(); });

  intentEl.addEventListener('click', nextIntent);
  intentEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      nextIntent();
    }
  });

  document.addEventListener('visibilitychange', () => {
    if (document.hidden && running) {
      clearTimers();
    } else if (!document.hidden && running) {
      startGlowLoop();
      if (firstCycleGuidance) startFirstCycleLabels();
    }
  });

  enBtn.addEventListener('click', () => {
    enBtn.classList.add('active');
    esBtn.classList.remove('active');
    setLanguage('en');
  });

  esBtn.addEventListener('click', () => {
    esBtn.classList.add('active');
    enBtn.classList.remove('active');
    setLanguage('es');
  });

  // Init
  enBtn.classList.add('active');
  setLanguage('en');

})();
</script>
</body>
</html>
