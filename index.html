<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>field</title>
<meta name="theme-color" content="#dce9e4"/>
<style>
:root{
--bg1:#edf6f2;--bg2:#dce9e4;--bg3:#cfded8;
--jade1:#a6edd0;--jade2:#7fd9b2;
--ink:rgba(47,63,58,.85);--inkSoft:rgba(47,63,58,.55);
--breathSec:16s;--minScale:.7;--maxScale:1.12;
--circleSize:min(92vw,440px);
}
*{margin:0;padding:0;box-sizing:border-box}
body{
min-height:100vh;
background:
radial-gradient(900px 600px at 50% 0%,rgba(166,237,208,.25),transparent 65%),
radial-gradient(900px 600px at 50% 25%,rgba(255,255,255,.6),transparent 70%),
linear-gradient(var(--bg1),var(--bg2) 55%,var(--bg3));
display:flex;justify-content:center;align-items:center;
font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
color:var(--ink);-webkit-font-smoothing:antialiased}
.app{width:100%;max-width:520px;padding:48px 22px 64px;text-align:center}
.header{
font-size:clamp(60px,12vw,88px);letter-spacing:.32em;font-weight:500;
color:var(--inkSoft);margin-bottom:12px;transition:opacity 2.4s ease;
/* Optical centering compensation for heavy tracking */
transform: translateX(0.16em);
}
.header.fade{opacity:.07}
.lang{position:fixed;top:14px;right:18px;font-size:13px;letter-spacing:.14em;opacity:.6}
.lang span{cursor:pointer}
.lang span.active{opacity:1;text-decoration:underline;text-underline-offset:4px}
.circleWrap{position:relative;width:var(--circleSize);height:var(--circleSize);margin:0 auto 22px}
.circle{
width:100%;height:100%;border-radius:50%;
background:radial-gradient(circle at 30% 30%,var(--jade1),var(--jade2));
display:flex;align-items:center;justify-content:center;cursor:pointer;
box-shadow:0 0 60px rgba(127,217,178,.35);
will-change:transform;
-webkit-mask-image:radial-gradient(circle,black 62%,transparent 100%);
mask-image:radial-gradient(circle,black 62%,transparent 100%)}
.circle::after{
content:"";position:absolute;inset:-20%;border-radius:50%;
background:radial-gradient(circle,rgba(127,217,178,.2),transparent 65%);
filter:blur(2px)}
.circle.breath{animation:breathe var(--breathSec) cubic-bezier(.42,0,.18,1) infinite}
@keyframes breathe{
0%{transform:scale(var(--minScale))}
50%{transform:scale(var(--maxScale))}
100%{transform:scale(var(--minScale))}}
.overlay{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;padding:22px}
.text{
max-width:26ch;opacity:0;filter:blur(2px);
transform:translateY(2px);
transition:opacity 1.4s,filter 1.4s,transform 1.4s}
.text.show{opacity:1;filter:blur(0);transform:none}
.guide{font-weight:650;letter-spacing:.18em;text-transform:uppercase;
font-size:clamp(18px,5vw,24px);color:var(--inkSoft)}
.koan{font-weight:520;font-size:clamp(19px,5.6vw,27px);line-height:1.35}
.controls{display:flex;justify-content:center;align-items:center;gap:12px;margin-top:6px}
button{
border:none;border-radius:999px;padding:12px 30px;font-weight:650;
background:linear-gradient(135deg,var(--jade1),var(--jade2));
color:var(--ink);cursor:pointer}
#next{
background:transparent;border:1px solid rgba(47,63,58,.15);
color:rgba(47,63,58,.6);
display:none; /* don't reserve space until it's ready */
}
#next.show{display:inline-block;}
</style>
</head>
<body>

<div class="lang">
<span id="en">EN</span> · <span id="es">ES</span>
</div>

<div class="app">
<div class="header" id="header">field</div>

<div class="circleWrap">
<div class="circle" id="circle">
<div class="overlay">
<div class="text show" id="overlay">
Breathe with the circle.<br>Let a question open the field.
</div>
</div>
</div>
</div>

<div class="controls">
<button id="start">START</button>
<button id="next">NEXT</button>
</div>
</div>

<script>
(()=>{

const TEXT={
en:{start:"START",stop:"STOP",next:"NEXT",
inhale:"INHALE",exhale:"EXHALE",inS:"IN",outS:"OUT",
pre:"Breathe with the circle.<br>Let a question open the field.",
koans:[
"What is here before thought?","Who is aware now?","What remains when effort drops?",
"If nothing is missing, what is sought?","What knows this silence?",
"Where does stillness come from?","Who is breathing this breath?",
"Before I, what is?","What is present without trying?","What remains when nothing is held?"
]},
es:{start:"COMENZAR",stop:"DETENER",next:"OTRA",
inhale:"INHALA",exhale:"EXHALA",inS:"IN",outS:"OUT",
pre:"Respira con el círculo.<br>Deja que una pregunta abra el campo.",
koans:[
"¿Qué hay antes del pensamiento?","¿Quién es consciente ahora?",
"¿Qué queda cuando cae el esfuerzo?","Si nada falta, ¿qué se busca?",
"¿Qué conoce este silencio?","¿De dónde surge la quietud?",
"¿Quién respira este aliento?","Antes de yo, ¿qué es?",
"¿Qué está presente sin intentar?","¿Qué permanece cuando nada se sostiene?"
]}
};

const BREATH=16000,FIRST=26000,SILENCE=3000;

const circle=document.getElementById("circle"),
overlay=document.getElementById("overlay"),
start=document.getElementById("start"),
next=document.getElementById("next"),
header=document.getElementById("header"),
en=document.getElementById("en"),
es=document.getElementById("es");

let lang=localStorage.getItem("field_lang")||"en",
running=false,current="",timers=[];
let audioCtx,gain,noise;

function audioInit(){
if(audioCtx)return;
audioCtx=new(AudioContext||webkitAudioContext)();
const buf=audioCtx.createBuffer(1,2*audioCtx.sampleRate,audioCtx.sampleRate);
const d=buf.getChannelData(0);
for(let i=0;i<d.length;i++)d[i]=Math.random()*2-1;
noise=audioCtx.createBufferSource();
noise.buffer=buf;noise.loop=true;
const lp=audioCtx.createBiquadFilter();
lp.type="lowpass";lp.frequency.value=900;
gain=audioCtx.createGain();gain.gain.value=0;
noise.connect(lp);lp.connect(gain);gain.connect(audioCtx.destination);
noise.start();
}

function fade(v,t=2){
if(!gain)return;
const n=audioCtx.currentTime;
gain.gain.linearRampToValueAtTime(v,n+t);
}

function show(txt,cls){
overlay.className="text "+cls+" show";
overlay.innerHTML=txt;
}
function hide(){overlay.classList.remove("show")}

function clearTimers(){timers.forEach(t=>clearTimeout(t));timers=[]}

function guide(){
clearTimers();
timers.push(setTimeout(()=>hide(),600));
timers.push(setTimeout(()=>show(TEXT[lang].inhale,"guide"),900));
timers.push(setTimeout(()=>show(TEXT[lang].exhale,"guide"),7900));
timers.push(setTimeout(()=>show(TEXT[lang].inS,"guide"),16900));
timers.push(setTimeout(()=>show(TEXT[lang].outS,"guide"),23900));
// (Removed KEEP GOING to avoid any post-koan pop-in)

}

function pick(){const a=TEXT[lang].koans;return a[Math.floor(Math.random()*a.length)]}

function schedule(){
timers.push(setTimeout(()=>{
hide();
setTimeout(()=>{
if(!running)return;
current=pick();
show(current,"koan");
next.classList.add("show");
},SILENCE);
},FIRST));
}

function startS(){
if(running)return;
running=true;
header.classList.add("fade");
circle.classList.add("breath");
start.textContent=TEXT[lang].stop;
audioInit();audioCtx.resume();fade(.05,2);
guide();schedule();
}

function stopS(){
running=false;
header.classList.remove("fade");
circle.classList.remove("breath");
start.textContent=TEXT[lang].start;
clearTimers();next.classList.remove("show");
fade(0,2);
show(TEXT[lang].pre,"");
}

function replay(){
if(!current)return;
hide();setTimeout(()=>show(current,"koan"),600);
}

start.onclick=()=>running?stopS():startS();

next.onclick=()=>{
if(!running)return;
hide();
setTimeout(()=>{current=pick();show(current,"koan")},800);
};

circle.onclick=()=>{
if(!running)startS();
else if(current)replay();
};

function setLang(l){
lang=l;localStorage.setItem("field_lang",l);
en.classList.toggle("active",l==="en");
es.classList.toggle("active",l==="es");
start.textContent=running?TEXT[l].stop:TEXT[l].start;
next.textContent=TEXT[l].next;
if(!running)show(TEXT[l].pre,"");
}

en.onclick=()=>!running&&setLang("en");
es.onclick=()=>!running&&setLang("es");

document.addEventListener("visibilitychange",()=>{
if(!running)return;
if(document.hidden)fade(0,.3);
else{audioInit();audioCtx.resume();fade(.05,.8)}
});

setLang(lang);

})();
</script>
</body>
</html>
