<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Coherence</title>
  <meta name="theme-color" content="#080f12">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%2378f0b1'/></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#080f12;
      --surface:#111c24;
      --border:rgba(255,255,255,.06);
      --border-h:rgba(255,255,255,.13);
      --text:#dde8f0;
      --text-dim:#607587;
      --text-muted:#334455;
      --accent:#78f0b1;
      --accent-dim:rgba(120,240,177,.10);
      --accent-glow:rgba(120,240,177,.28);
      --font-d:'DM Serif Display', Georgia, serif;
      --font-b:'DM Sans', system-ui, sans-serif;
      --r:18px;
      --r-sm:11px;
      --ease: cubic-bezier(.4,0,.2,1);
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:var(--font-b);
      background:var(--bg);
      color:var(--text);
      min-height:100vh;
      -webkit-font-smoothing:antialiased;
      overflow-x:hidden;
    }

    body::before{
      content:'';
      position:fixed; inset:0;
      background:
        radial-gradient(ellipse 80vw 60vw at 50% -10%, rgba(120,240,177,.04) 0%, transparent 70%),
        radial-gradient(ellipse 60vw 40vw at 90% 80%, rgba(122,184,255,.03) 0%, transparent 60%);
      pointer-events:none;
      z-index:0;
    }

    .page{
      position:relative; z-index:1;
      max-width:520px;
      margin:0 auto;
      padding:28px 18px 70px;
      text-align:center;
    }

    .field{
      font-family:var(--font-d);
      font-weight:300;
      letter-spacing:.14em;
      text-transform:lowercase;
      font-size:3.6rem;
      opacity:.92;
      margin:6px 0 18px;
      transition: opacity 1.8s ease 0.8s;
      user-select:none;
    }

    .card{
      background:var(--surface);
      border:1px solid var(--border);
      border-radius:var(--r);
      padding:26px 22px 24px;
      position:relative;
      overflow:hidden;
    }

    .circle-wrap{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      margin:8px 0 16px;
    }

    .circle{
      width:176px;height:176px;
      border-radius:50%;
      background:
        radial-gradient(circle at 33% 28%, rgba(255,255,255,.22) 0%, transparent 55%),
        var(--accent);
      box-shadow:
        0 0 70px var(--accent-glow),
        inset 0 1px 0 rgba(255,255,255,.28);
      transition:
        transform 900ms var(--ease),
        filter 600ms ease;
      cursor:pointer;
      user-select:none;
      position:relative;
    }

    .circle.inhale{transform:scale(1.18); filter:brightness(1.10);}
    .circle.exhale{transform:scale(.82); filter:brightness(.93);}

    .phase{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      pointer-events:none;
    }

    .phase-text{
      font-size:10px;
      font-weight:700;
      letter-spacing:.12em;
      text-transform:uppercase;
      color:rgba(8,20,14,.62);
    }

    .cue{
      font-family:var(--font-d);
      font-size:26px;
      line-height:1.15;
      margin:12px 0 10px;
      min-height:34px;
      transition: opacity .25s ease;
    }
    .cue.fade{opacity:0;}

    .row{
      display:flex;
      justify-content:center;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    .chip{
      appearance:none;
      border:1px solid var(--border);
      background:rgba(0,0,0,0);
      color:var(--text-dim);
      border-radius:999px;
      padding:7px 14px;
      font-size:12px;
      font-weight:700;
      cursor:pointer;
      transition: all .18s var(--ease);
      user-select:none;
    }
    .chip:hover{border-color:var(--border-h); color:var(--text);}
    .chip.active{
      background:var(--accent-dim);
      border-color:rgba(120,240,177,.26);
      color:var(--accent);
    }

    .btn{
      appearance:none;
      border:none;
      border-radius:999px;
      padding:12px 36px;
      font-size:14px;
      font-weight:800;
      font-family:var(--font-b);
      cursor:pointer;
      transition: transform .18s var(--ease), filter .18s var(--ease);
      user-select:none;
    }

    .btn.primary{
      background:var(--accent);
      color:#0a180f;
      box-shadow:0 4px 22px var(--accent-glow);
    }
    .btn.primary:hover{transform:translateY(-1px); filter:brightness(1.02);}
    .btn.primary.running{
      background:rgba(255,255,255,.06);
      color:var(--text-dim);
      box-shadow:none;
    }

    .btn.ghost{
      background:rgba(255,255,255,.04);
      color:var(--text-dim);
      border:1px solid var(--border);
      padding:9px 16px;
      font-size:12px;
      font-weight:700;
      border-radius:var(--r-sm);
    }
    .btn.ghost:hover{border-color:var(--border-h); color:var(--text);}

    .note{
      margin-top:14px;
      background:rgba(120,240,177,.08);
      border:1px solid rgba(120,240,177,.14);
      border-radius:var(--r-sm);
      padding:10px 12px;
      font-size:12px;
      color:var(--text-dim);
      line-height:1.55;
      text-align:left;
    }
    .note strong{color:var(--text); font-weight:600;}

    .modal{
      position:fixed; inset:0; z-index:10;
      background:rgba(8,15,18,.86);
      backdrop-filter: blur(10px);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:22px;
      opacity:0;
      pointer-events:none;
      transition: opacity .25s ease;
    }
    .modal.visible{
      opacity:1;
      pointer-events:auto;
    }
    .modal-box{
      width:100%;
      max-width:380px;
      background:var(--surface);
      border:1px solid var(--border-h);
      border-radius:24px;
      padding:26px 22px;
      text-align:center;
    }
    .modal-title{
      font-family:var(--font-d);
      font-size:28px;
      margin-bottom:8px;
    }
    .modal-body{
      font-size:13px;
      color:var(--text-dim);
      line-height:1.6;
      margin-bottom:16px;
    }

    .spacer{height:8px;}
  </style>
</head>
<body>
  <div class="page">
    <div class="field" id="fieldWord">field</div>

    <div class="card">
      <div class="circle-wrap">
        <div class="circle" id="circle" aria-label="breath circle" role="button" tabindex="0">
          <div class="phase">
            <div class="phase-text" id="phaseText">tap to begin</div>
          </div>
        </div>
      </div>

      <div class="row" aria-label="duration">
        <button class="chip" data-min="5" id="d5">5m</button>
        <button class="chip" data-min="10" id="d10">10m</button>
        <button class="chip" data-min="15" id="d15">15m</button>
      </div>

      <div class="cue" id="cueLine">Equanimity and awareness</div>

      <div class="row">
        <button class="btn ghost" id="changeCue">Change</button>
      </div>

      <div class="spacer"></div>

      <button class="btn primary" id="startBtn">Start</button>

      <div class="note" id="note">
        <strong>The field is shared.</strong> Breathe gently. Let the next breath arrive.
      </div>
    </div>
  </div>

  <div class="modal" id="doneModal" aria-hidden="true">
    <div class="modal-box">
      <div class="modal-title">Session complete</div>
      <div class="modal-body">Stay with the quiet for a moment.</div>
      <button class="btn primary" id="doneBtn">Done</button>
    </div>
  </div>

<script>
(() => {
  'use strict';

  const IN = 5.5;
  const HOLD = 0;
  const OUT = 5.5;

  const KEY = {
    durationMin: 'orion_duration_min_v1',
    cueIdx: 'orion_cue_idx_v1'
  };

  const CUES = [
    'Equanimity and awareness',
    'Steady and open',
    'Let the exhale land',
    'Nothing to fix',
    'Soft eyes, soft jaw',
    'Receive this moment',
    'Gentle return'
  ];

  const $ = (id) => document.getElementById(id);

  const circle = $('circle');
  const phaseText = $('phaseText');
  const startBtn = $('startBtn');
  const fieldWord = $('fieldWord');

  const dBtns = [ $('d5'), $('d10'), $('d15') ];
  const cueLine = $('cueLine');
  const changeCue = $('changeCue');

  const doneModal = $('doneModal');
  const doneBtn = $('doneBtn');

  let running = false;
  let totalRemaining = 0;
  let phase = 'idle';
  let phaseRemaining = 0;
  let tick = null;
  let cueIdx = 0;
  let durationMin = 5;

  function haptic(ms=10){ try{ if (navigator.vibrate) navigator.vibrate(ms); }catch(e){} }

  function setDuration(min){
    durationMin = min;
    localStorage.setItem(KEY.durationMin, String(min));
    dBtns.forEach(b => b.classList.toggle('active', +b.dataset.min === min));
  }

  function setCue(idx){
    cueIdx = idx;
    localStorage.setItem(KEY.cueIdx, String(idx));
    cueLine.textContent = CUES[idx] || CUES[0];
  }

  function fadeFieldOut(){
    fieldWord.style.opacity = '0';
  }

  function showField(){
    fieldWord.style.transition = 'opacity 0.8s ease';
    fieldWord.style.opacity = '.92';
    setTimeout(() => {
      fieldWord.style.transition = 'opacity 1.8s ease 0.8s';
    }, 850);
  }

  function setPhase(p, dur){
    phase = p;
    phaseRemaining = dur;

    circle.classList.remove('inhale','exhale');

    if (p === 'in'){
      circle.classList.add('inhale');
      phaseText.textContent = 'inhale';
    } else if (p === 'out'){
      circle.classList.add('exhale');
      phaseText.textContent = 'exhale';
    } else {
      phaseText.textContent = 'tap to begin';
    }
    haptic(6);
  }

  function advancePhase(){
    if (phase === 'idle' || phase === 'out'){
      setPhase('in', IN);
    } else if (phase === 'in'){
      if (HOLD > 0) {
        setPhase('hold', HOLD);
      } else {
        setPhase('out', OUT);
      }
    } else if (phase === 'hold'){
      setPhase('out', OUT);
    }
  }

  function start(){
    running = true;
    totalRemaining = Math.max(1, durationMin) * 60;

    startBtn.textContent = 'Stop';
    startBtn.classList.add('running');

    fadeFieldOut();
    advancePhase();

    tick = setInterval(() => {
      totalRemaining -= 1;
      phaseRemaining -= 1;

      if (phaseRemaining <= 0) advancePhase();

      if (totalRemaining <= 0){
        stop(true);
      }
    }, 1000);
  }

  function stop(completed){
    running = false;
    clearInterval(tick);
    tick = null;

    circle.classList.remove('inhale','exhale');
    phase = 'idle';
    phaseText.textContent = 'tap to begin';

    startBtn.textContent = 'Start';
    startBtn.classList.remove('running');

    showField();

    if (completed){
      haptic(35);
      doneModal.classList.add('visible');
      doneModal.setAttribute('aria-hidden','false');
    }
  }

  function toggle(){
    if (running) stop(false);
    else start();
    haptic(10);
  }

  startBtn.addEventListener('click', toggle);
  circle.addEventListener('click', () => { if (!running) toggle(); });

  circle.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      if (!running) toggle();
    }
  });

  dBtns.forEach(b => {
    b.addEventListener('click', () => {
      if (running) return;
      setDuration(+b.dataset.min);
      haptic(8);
    });
  });

  changeCue.addEventListener('click', () => {
    cueLine.classList.add('fade');
    setTimeout(() => {
      const next = (cueIdx + 1) % CUES.length;
      setCue(next);
      cueLine.classList.remove('fade');
    }, 150);
    haptic(8);
  });

  doneBtn.addEventListener('click', () => {
    doneModal.classList.remove('visible');
    doneModal.setAttribute('aria-hidden','true');
    haptic(10);
  });

  (function init(){
    const savedDur = +localStorage.getItem(KEY.durationMin);
    if ([5,10,15].includes(savedDur)) setDuration(savedDur);
    else setDuration(5);

    const savedCue = +localStorage.getItem(KEY.cueIdx);
    if (!Number.isNaN(savedCue) && savedCue >= 0 && savedCue < CUES.length) setCue(savedCue);
    else setCue(0);
  })();
})();
</script>
</body>
</html>
